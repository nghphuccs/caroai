<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Caro AI Web</title>
  <style>
    body { font-family: Arial; text-align: center; }
    #board { display: grid; grid-template-columns: repeat(15, 40px); margin: 20px auto; }
    .cell {
      width: 40px; height: 40px; border: 1px solid #333;
      display: flex; align-items: center; justify-content: center;
      font-size: 20px; cursor: pointer;
    }
    #result { margin: 20px; font-size: 20px; color: red; }
    #play-again { display: none; padding: 10px 20px; font-size: 16px; }
  </style>
</head>
<body>
  <h1>Caro AI</h1>
  <div id="board"></div>
  <div id="result"></div>
  <button id="play-again">Chơi lại</button>

  <script>
    const SIZE = 15;
    let board = Array.from({ length: SIZE }, () => Array(SIZE).fill(0));
    let playerTurn = true;
    const boardEl = document.getElementById("board");
    const resultEl = document.getElementById("result");
    const playAgainBtn = document.getElementById("play-again");

    function drawBoard() {
      boardEl.innerHTML = "";
      for (let y = 0; y < SIZE; y++) {
        for (let x = 0; x < SIZE; x++) {
          const cell = document.createElement("div");
          cell.className = "cell";
          cell.textContent = board[y][x] === 1 ? "X" : board[y][x] === -1 ? "O" : "";
          cell.onclick = () => handleClick(x, y);
          boardEl.appendChild(cell);
        }
      }
    }

    function handleClick(x, y) {
      if (!playerTurn || board[y][x] !== 0) return;
      board[y][x] = 1;
      if (checkWin(1)) {
        showResult("Player WIN!");
        return;
      }
      playerTurn = false;
      drawBoard();
      fetch("/ai-move", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ board: board })
      })
      .then(res => res.json())
      .then(data => {
        const [aiX, aiY] = data.move;
        board[aiY][aiX] = -1;
        if (checkWin(-1)) {
          showResult("AI WIN!");
          return;
        }
        playerTurn = true;
        drawBoard();
      });
    }

    function showResult(text) {
      resultEl.textContent = text;
      playAgainBtn.style.display = "inline-block";
    }

    function checkWin(player) {
      const inLine = (x, y, dx, dy) => {
        for (let i = 0; i < 5; i++) {
          const nx = x + dx * i;
          const ny = y + dy * i;
          if (nx < 0 || nx >= SIZE || ny < 0 || ny >= SIZE || board[ny][nx] !== player) {
            return false;
          }
        }
        return true;
      };
      for (let y = 0; y < SIZE; y++) {
        for (let x = 0; x < SIZE; x++) {
          if (
            inLine(x, y, 1, 0) ||
            inLine(x, y, 0, 1) ||
            inLine(x, y, 1, 1) ||
            inLine(x, y, 1, -1)
          ) return true;
        }
      }
      return false;
    }

    playAgainBtn.onclick = () => {
      board = Array.from({ length: SIZE }, () => Array(SIZE).fill(0));
      resultEl.textContent = "";
      playAgainBtn.style.display = "none";
      playerTurn = true;
      drawBoard();
    };

    drawBoard();
  </script>
</body>
</html>
